//Author - Kartik Jadhav. 2021. Copyrights @ Quantum Pixel Intelligence. All Rights Reserved.
window.onbeforeunload=function(e){return confirm("Confirm refresh")},window.onload=function(){let e,t,n=document.getElementById("canvas"),l=n.getContext("2d"),o=20,c=n.width=window.innerWidth-o,a=n.height=window.innerHeight-3*o;alert("Welcome to Grids-Ai.com. This software is operational only from computer or laptop at the moment."),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(getElementById("body").style.display="none");let r,s,g,d,h,u,m,p,f="black",v="black",w=new Vector(0,0),y=new Vector(0,0),L=[],C=!1,X=[],Y=[],E=!1,k=!1,M=!1,b=!1,T=!1,S=!1,V=!1,x=.5,H=!0,A=!0,I=[],B=[],q=[],D=[],P=[],W=!1,F=[],R=[],O=[],j=[],N=[],z=[],G=[],Q=[],U=!1,J=[],K=!1,Z=[],$=document.querySelector(".modalShuffle-bg"),_=()=>{let e=document.getElementById("currentCellArea").value;"0.0625"==e?x=.0625:"0.09"==e?x=.09:"0.0225"==e?x=.0225:"0.25"==e?x=.25:"0.36"==e?x=.36:"0.0929"==e?x=.0929:"0.371"==e?x=.371:"0.836"==e?x=.836:"2.32"==e?x=2.32:"9.29"==e?x=9.29:"1"==e?x=1:"2.25"==e?x=2.25:"4"==e?x=4:"6.25"==e?x=6.25:"9"==e?x=9:"12.25"==e?x=12.25:"16"==e?x=16:"25"==e?x=25:"36"==e?x=36:"49"==e?x=49:"64"==e?x=64:"81"==e?x=81:"100"==e?x=100:"121"==e?x=121:"144"==e?x=144:"169"==e?x=169:"196"==e?x=196:"225"==e?x=225:"400"==e?x=400:"625"==e?x=625:"2500"==e&&(x=2500)},ee=(e,t)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)),te=ee(80,200),ne=ee(80,200),le=ee(80,200);currentCol="rgb("+te+","+ne+","+le+")";const ie=(e,t)=>{let n=0;for(let l=0;l<e.length;l++)e[l]!==t?Array.isArray(e[l])&&(n+=ie(e[l],t)):n++;return n};let oe=document.querySelector(".areaTable"),ce=(e,t,n)=>{for(let n=t.length;n>e;n--)t[n]=t[n-1];t[e]=n},ae=()=>{rect=n.getBoundingClientRect(),e=event.clientX-rect.left,t=event.clientY-rect.top,w.setX(e),w.setY(t)},re=()=>{let e=w.getX()%o,t=w.getY()%o;return new Vector(w.getX()-e,w.getY()-t)},se=()=>{let e=w.getX()%o,t=w.getY()%o,n=new Vector(w.getX()-e,w.getY()-t),l=new Vector(w.getX()-e+o,w.getY()-t),i=new Vector(w.getX()-e+o,w.getY()-t+o),c=new Vector(w.getX()-e,w.getY()-t+o),a=utils.distance(w,n),r=utils.distance(w,l),s=utils.distance(w,i),g=utils.distance(w,c);return g<a&&g<r&&g<s?c:s<a&&s<r&&s<g?i:r<a&&r<s&&r<g?l:n};class ge{constructor(e,t){this.v1=e,this.col="black",this.size=t,this.strokeStyle="black"}draw(){l.beginPath(),l.arc(this.v1.getX(),this.v1.getY(),this.size,0,2*Math.PI,!1),l.fillStyle=this.col,l.fill()}changeCol(e){this.col=e}onStroke(){l.stroke()}}class de{constructor(e,t){this.v1=e,this.v2=t,this.lW=1,this.col=f,this.pattern=[],this.cap="square"}draw(){l.beginPath(),l.moveTo(this.v1.getX(),this.v1.getY()),l.lineTo(this.v2.getX(),this.v2.getY()),l.lineCap=this.cap,l.setLineDash(this.pattern),l.lineWidth=this.lW,l.strokeStyle=this.col,l.stroke()}changeCol(e){this.col=e}changeWidth(e){this.lW=e}setDashPattern(e,t){this.pattern=[e,t]}getLength(){return new Vector(this.v2.getX()-this.v1.getX(),this.v2.getY()-this.v1.getY()).getLength()}setV1(e){this.v1=e}setV2(e){this.v2=e}}class he{constructor(e,t){this.v1=e,this.v2=new Vector(this.v1.getX()+o,this.v1.getY()),this.v3=new Vector(this.v1.getX()+o,this.v1.getY()+o),this.v4=new Vector(this.v1.getX(),this.v1.getY()+o),this.lineWidth=.5,this.col=t,this.l1=new de(this.v1,this.v2),this.l2=new de(this.v2,this.v3),this.l3=new de(this.v3,this.v4),this.l4=new de(this.v4,this.v1)}draw(){l.beginPath(),l.rect(this.v1.getX()+.5,this.v1.getY()+.5,o-1,o-1),l.fillStyle=this.col,l.fill(),Ve&&(this.l1.changeWidth(.2),this.l2.changeWidth(.2),this.l3.changeWidth(.2),this.l4.changeWidth(.2),this.l1.draw(),this.l2.draw(),this.l3.draw(),this.l4.draw())}changeCol(e){this.col=e}getSide(e){return"l1"==e||1==e?this.l1:"l2"==e||2==e?this.l2:"l3"==e||3==e?this.l3:"l4"==e||4==e?this.l4:void 0}changeSideWidth(e,t){this.getSide(e).changeWidth(t)}changeSideCol(e,t){this.getSide(e).changeCol(t)}}let ue=e=>{for(let t=0;t<L.length;t++)L[t].getX()==e.getX()&&L[t].getY()==e.getY()&&(L.splice(t,1),Y.splice(t,1))},me=()=>{for(let e=0;e<X.length;e++)X[e].setDashPattern(20,20),X[e].changeWidth(3),X[e].changeCol("black"),X[e].draw()},pe=(e,t)=>{let n;for(let l=0;l<t.length;l++){if(e.getX()==t[l].getX()&&e.getY()==t[l].getY()){n=!0;break}n=!1}return n},fe=(e,t)=>{let n;for(let l=0;l<t.length;l++)if(e.getX()==t[l].getX()&&e.getY()==t[l].getY()){n=l;break}return n},ve=(e,t)=>{for(let n=0;n<t.length;n++)if(e.getX()==t[n].getX()&&e.getY()==t[n].getY())return n},we=e=>{if(null==L[0]||0==pe(e,L))L.push(e),Y.push(currentCol);else{let t=ve(e,L);Y[t]=currentCol}};n.addEventListener("pointerdown",e=>{if(ae(),y=re(),r=y,E){C=!1;let e=ve(r,L);null!=Y[e]&&(h=Y[e]),E=!1,currentCol=h}else if(M&&0==b&&0==V&&0==K)y=se(),r=y,C=!0,A=!0,B.push(r);else if(0==b&&0==S&&0==V&&0==K)C=!0;else if(0==b&&1==S&&0==V&&0==K)if(C=!0,pe(y,L)){let e=fe(y,L);d=Y[e];for(let e=0;e<L.length;e++)Y[e]==d&&G.push(L[e])}else S=!1;else if(0==b&&0==S&&1==V&&0==K){C=!0;for(let e=0;e<L.length;e++)J.push(L[e])}else 0==b&&0==S&&0==V&&1==K&&(Z.splice(0,Z.length),C=!0,y=se(),r=y)},!1),n.addEventListener("pointermove",e=>{new Vector(w.getX(),w.getY());if(1==C&&0==M&&0==S&&0==V){ae(),y=re(),X.splice(0,X.length);let e=y.getX()-r.getX(),t=y.getY()-r.getY();if(e>=0&&t>=0){g=new Vector(y.getX()+o,y.getY()+o);let e=new de(r,g),t=new Vector(e.v1.getX(),e.v1.getY()),n=new Vector(e.v1.getX()+(e.v2.getX()-t.getX()),t.getY()),l=new Vector(e.v2.getX(),e.v2.getY()),i=new Vector(e.v1.getX(),e.v1.getY()+(e.v2.getY()-t.getY())),c=new de(t,n),a=new de(n,l),s=new de(l,i),d=new de(i,t);u=c.getLength()/o,m=a.getLength()/o,X.push(c),X.push(a),X.push(s),X.push(d)}else if(e<0&&t>=0){g=new Vector(y.getX(),y.getY()+o);let e=new Vector(r.getX()+o,r.getY()),t=new de(e,g),n=new Vector(t.v1.getX(),t.v1.getY()),l=new Vector(t.v1.getX()+(t.v2.getX()-n.getX()),n.getY()),i=new Vector(t.v2.getX(),t.v2.getY()),c=new Vector(t.v1.getX(),t.v1.getY()+(t.v2.getY()-n.getY())),a=new de(n,l),s=new de(l,i),d=new de(i,c),h=new de(c,n);u=a.getLength()/o,m=s.getLength()/o,X.push(a),X.push(s),X.push(d),X.push(h)}else if(e>=0&&t<0){g=new Vector(y.getX()+o,y.getY());let e=new Vector(r.getX(),r.getY()+o),t=new de(e,g),n=new Vector(t.v1.getX(),t.v1.getY()),l=new Vector(t.v1.getX()+(t.v2.getX()-n.getX()),n.getY()),i=new Vector(t.v2.getX(),t.v2.getY()),c=new Vector(t.v1.getX(),t.v1.getY()+(t.v2.getY()-n.getY())),a=new de(n,l),s=new de(l,i),d=new de(i,c),h=new de(c,n);u=a.getLength()/o,m=s.getLength()/o,X.push(a),X.push(s),X.push(d),X.push(h)}else if(e<0&&t<0){g=new Vector(y.getX(),y.getY());let e=new Vector(r.getX()+o,r.getY()+o),t=new de(e,g),n=new Vector(t.v1.getX(),t.v1.getY()),l=new Vector(t.v1.getX()+(t.v2.getX()-n.getX()),n.getY()),i=new Vector(t.v2.getX(),t.v2.getY()),c=new Vector(t.v1.getX(),t.v1.getY()+(t.v2.getY()-n.getY())),a=new de(n,l),s=new de(l,i),d=new de(i,c),h=new de(c,n);u=a.getLength()/o,m=s.getLength()/o,X.push(a),X.push(s),X.push(d),X.push(h)}}else if(1==C&&1==M&&0==b&&0==S&&0==V&&0==K){ae(),y=se(),I.splice(0,I.length);let e=new de(r,y);I.push(e),p=e.getLength()/o}else if(1==C&&0==M&&1==S&&0==b&&0==V&&0==K){ae(),Q.splice(0,Q.length),X.splice(0,X.length),y=se(),dragTE=y;let e=new Vector(dragTE.getX()-r.getX(),dragTE.getY()-r.getY());if(1==U)for(let e=0;e<G.length;e++){let t=fe(G[e],L);Y[t]=d}else for(let e=0;e<G.length;e++){let t=fe(G[e],L);utils.distance(dragTE,r)>o?Y[t]="red":Y[t]=d}for(let t=0;t<G.length;t++){let n=fe(G[t],L),l=new Vector(L[n].getX()+e.getX(),L[n].getY()+e.getY());Q.push(l)}let t=new de(r,dragTE);X.push(t)}else if(1==C&&0==M&&0==S&&0==b&&1==V&&0==K){ae(),Q.splice(0,Q.length),X.splice(0,X.length),y=se(),dragTE=y;let e=new Vector(dragTE.getX()-r.getX(),dragTE.getY()-r.getY());for(let t=0;t<J.length;t++){let n=new Vector(J[t].getX()+e.getX(),J[t].getY()+e.getY());Q.push(n)}let t=new de(r,dragTE);X.push(t)}else K&&C&&(H=!1)},!1),n.addEventListener("pointerup",e=>{if(1==C&&0==M&&0==S&&0==V&&0==k&&0==K){ae(),y=re();let e=(s=y).getX()-r.getX(),t=s.getY()-r.getY();for(let n=0;n<=Math.abs(e);n+=o)for(let l=0;l<=Math.abs(t);l+=o)if(e>1&&t>1){let e=new Vector(r.getX()+n,r.getY()+l);T?ue(e):we(e)}else if(e<1&&t>1){let e=new Vector(r.getX()-n,r.getY()+l);T?ue(e):we(e)}else if(e>1&&t<1){let e=new Vector(r.getX()+n,r.getY()-l);T?ue(e):we(e)}else if(e<1&&t<1){let e=new Vector(r.getX()-n,r.getY()-l);T?ue(e):we(e)}}else if(1==C&&1==M&&0==b&&0==S&&0==V&&0==k&&0==K)ae(),y=se(),s=y,q.push(s),D.push(v),P.push(4);else if(1==C&&0==M&&0==b&&1==S&&0==V&&0==k&&0==K){if(ae(),y=se(),s=y,utils.distance(r,s)>o){let e="rgb("+(Math.floor(200*Math.random())+80)+","+(Math.floor(200*Math.random())+80)+","+(Math.floor(200*Math.random())+80)+")";U&&(d=e);let t=new Vector(s.getX()-r.getX(),s.getY()-r.getY());for(let e=0;e<G.length;e++){let n=fe(G[e],L),l=new Vector(L[n].getX()+t.getX(),L[n].getY()+t.getY());if(pe(l,L)){let e=fe(l,L);d!=Y[e]?(L.splice(e,1),Y.splice(e,1),ce(e,L,l),ce(e,Y,d)):d==Y[e]&&(ce(n,L,l),ce(n,Y,d))}else ce(n,L,l),ce(n,Y,d)}if(0==U)for(let e=0;e<G.length;e++){let t=fe(G[e],L);Y[t]!=d&&(L.splice(t,1),Y.splice(t,1))}}}else if(1==C&&0==M&&0==b&&0==S&&1==V&&0==k&&0==K){ae(),y=se(),s=y;let e=new Vector(s.getX()-r.getX(),s.getY()-r.getY());for(let t=0;t<L.length;t++){let n=new Vector(L[t].getX()+e.getX(),L[t].getY()+e.getY());L[t]=new Vector(n.getX(),n.getY())}}if(K)if(ae(),y=re(),s=y,utils.distance(r,s)>o){for(let e=0;e<X.length;e++)Z.push(X[e]);H=!1}else H=!0,Z.splice(0,Z.length);b&&(()=>{for(let e=0;e<B.length;e++)if(utils.distance(w,B[e])+utils.distance(w,q[e])-utils.distance(B[e],q[e])<5){B.splice(e,1),q.splice(e,1),D.splice(e,1),P.splice(e,1),B.length==q.length&&P.length==B.length||(alert("rougue nation"),Me());break}})(),C=!1,X.splice(0,X.length),I.splice(0,I.length),G.splice(0,G.length),Q.splice(0,Q.length),J.splice(0,J.length)},!1);let ye=()=>{0!=L.length&&(E=!0,k=!1,M=!1,b=!1,T=!1,S=!1,V=!1,K=!1)},Le=()=>{E=!1,k=!1,M=!1,b=!1,S=!1,T=!0,V=!1,K=!1},Ce=()=>{E=!1,k=!1,M=!0,b=!1,S=!1,T=!1,V=!1,K=!1},Xe=()=>{E=!1,k=!1,M=!1,b=!1,S=!0,T=!1,U=!1,V=!1,K=!1},Ye=()=>{E=!1,k=!1,M=!1,b=!1,S=!1,T=!1,U=!1,V=!0,K=!1},Ee=()=>{E=!1,k=!1,M=!1,b=!1,S=!0,T=!1,U=!0,V=!1,K=!1},ke=()=>{E=!1,k=!1,M=!1,b=!1,S=!1,T=!1,V=!1,K=!1;let e=ee(80,200),t=ee(80,200),n=ee(80,200);currentCol="rgb("+e+","+t+","+n+")"},Me=()=>{k=!1,M=!1,b=!1,T=!1,S=!1,V=!1,K=!1,confirm("Are you sure you want to delete everything?")&&(L.splice(0,L.length),Y.splice(0,Y.length),q.splice(0,q.length),B.splice(0,B.length),D.splice(0,D.length),P.splice(0,P.length),O.splice(0,O.length),j.splice(0,j.length),N.splice(0,N.length),z.splice(0,z.length),Z.splice(0,Z.length),H=!0)},be=()=>{k=!1,M=!1,S=!1,T=!1,b=!0,V=!1,K=!1},Te=()=>{k=!0,b=!1,S=!1,T=!1,V=!1,K=!1,(M=!1)&&alert("Command inactive when Line command active. ")},Se=document.getElementById("active-command");Se.innerHTML="Please setup grid before getting started.",document.getElementById("addremove").addEventListener("click",function(){Le(),Se.innerHTML="Remove Cell -> Click and Drag"}),document.getElementById("lineToggle").addEventListener("click",function(){Ce(),Se.innerHTML="Add Line -> Click and Drag"}),document.getElementById("lineEraser").addEventListener("click",function(){be(),Se.innerHTML="Remove Line -> single click per line"}),document.getElementById("newspace").addEventListener("click",function(){ke(),Se.innerHTML="Add Cell with Random Color -> Click and Drag"}),document.getElementById("selSimilar").addEventListener("click",function(){Xe(),Se.innerHTML="Move Cells with same color together -> Click and Drag"}),document.getElementById("copySpace").addEventListener("click",function(){Ee(),Se.innerHTML="Copy Cells with same color together -> Click and Drag"}),document.getElementById("deleteall").addEventListener("click",function(){Me(),Se.innerHTML="Deleted All !"}),document.getElementById("moveAll").addEventListener("click",function(){Ye(),Se.innerHTML="Move Cells -> Click and Drag"}),document.getElementById("measure").addEventListener("click",function(){Te(),Se.innerHTML="Measure Cell Dimensions -> Click and Drag"}),document.getElementById("match").addEventListener("click",function(){ye(),Se.innerHTML="Match Cell Color. Click on a cell to pick a color, then click and drag to draw."}),document.getElementById("addsite").addEventListener("click",function(){K=!0,k=!1,b=!1,S=!1,T=!1,V=!1,(M=!1)&&alert("Command inactive when Line command active. "),Se.innerHTML="Drag diagonally/cross to create site. Kindly pay attention to live measurement feedback."});let Ve=!1;document.getElementById("downloadSn").addEventListener("click",function(){Ve=!0,Se.innerHTML="Snapshot Taken!"}),document.addEventListener("keydown",function(e){0==W&&(90==e.keyCode?(ke(),Se.innerHTML="Add Cell with Random Color -> Click and Drag"):88==e.keyCode?(Le(),Se.innerHTML="Remove Cell -> Click and Drag"):65==e.keyCode?(ye(),Se.innerHTML="Match Cell Color. Click on a cell to pick a color, then click and drag to draw."):83==e.keyCode?(Te(),Se.innerHTML="Measure Cell Dimensions -> Click and Drag"):81==e.keyCode?(Ce(),Se.innerHTML="Add Line -> Click and Drag"):87==e.keyCode?(be(),Se.innerHTML="Remove Line -> single click per line"):79==e.keyCode?$.classList.add("bgShuffle-active"):70==e.keyCode?(Xe(),Se.innerHTML="Move Cells with same color together -> Click and Drag"):68==e.keyCode?(Ee(),Se.innerHTML="Copy Cells with same color together -> Click and Drag"):71==e.keyCode&&(Ye(),Se.innerHTML="Move All Cells -> Click and Drag"))});let xe=document.querySelector(".modalProj-bg");document.getElementById("projSetup").addEventListener("click",function(){confirm("Once you change the grid size, then all areas will get scaled accordingly.")&&(xe.classList.add("bgProj-active"),Se.innerHTML="Click on any button to initiate command.")}),document.getElementById("save-proj-setup").addEventListener("click",function(){_(),xe.classList.remove("bgProj-active")});let He=document.querySelector(".modalDoc-bg");document.getElementById("docs").addEventListener("click",function(){Se.innerHTML="Click on any button to initiate command.",confirm("This command will write the Space Names and Areas as per latest update. Are you sure you want to continue?")&&(W=!0,(()=>{F.splice(0,F.length),R.splice(0,R.length),oe.innerHTML="",O.splice(0,O.length),j.splice(0,j.length),N.splice(0,N.length),z.splice(0,z.length);let e=document.createElement("tr"),t=document.createElement("th");t.innerHTML="Item",e.appendChild(t);let n=document.createElement("th");n.innerHTML="Space Name",e.appendChild(n);let l=document.createElement("th");l.innerHTML="Area",e.appendChild(l);let i=document.createElement("th");i.innerHTML="Space Type",e.appendChild(i),oe.appendChild(e);for(let e=0;e<Y.length;e++)0==F.includes(Y[e])&&F.push(Y[e]);for(let e=0;e<F.length;e++){let t=ie(Y,F[e]);R.push(t)}for(let e=0;e<F.length;e++){let t=document.createElement("tr"),n=document.createElement("td"),l=document.createElement("td"),i=document.createElement("td"),o=document.createElement("td"),c=document.createElement("input"),a=document.createElement("select"),r=document.createElement("option");r.innerHTML="Enclosed",a.appendChild(r);let s=document.createElement("option");s.innerHTML="Balcony",a.appendChild(s);let g=document.createElement("option");g.innerHTML="Corridor",a.appendChild(g);let d=document.createElement("option");d.innerHTML="Empty",a.appendChild(d);let h=document.createElement("option");h.innerHTML="Design",a.appendChild(h);let u="spacetypename"+e;a.setAttribute("class",u),o.appendChild(a),c.setAttribute("type","text");let m="colorName"+e;c.setAttribute("class",m),c.setAttribute("value","Room"),l.appendChild(c),n.style.backgroundColor=F[e];let p="colorPair"+e;n.setAttribute("class",p),t.appendChild(n),t.appendChild(l);let f=(R[e]*x).toFixed(2);i.innerHTML=f+" SQM";let v="areaClass"+e;i.setAttribute("class",v),t.appendChild(i),t.appendChild(o),oe.appendChild(t)}})(),He.classList.add("bgDoc-active"))}),document.getElementById("save-doc-setup").addEventListener("click",function(){for(let e=0;e<F.length;e++){let t=document.querySelector(".colorName"+e).value,n=document.querySelector(".colorPair"+e).style.backgroundColor,l=document.querySelector(".areaClass"+e).innerHTML,i=document.querySelector(".spacetypename"+e).selectedOptions[0].value;0==j.includes(n)&&(O.push(t),j.push(n),N.push(l),z.push(i))}W=!1,He.classList.remove("bgDoc-active")});let Ae=document.querySelector(".modalLine-bg");document.getElementById("lineToggle").addEventListener("click",function(){Ae.classList.add("bgLine-active")}),document.getElementById("save-line-setup").addEventListener("click",function(){Ae.classList.remove("bgLine-active"),(()=>{S=!1,k=!1,M=!1,b=!1,T=!1,V=!1,K=!1;let e=document.getElementById("lineStyle").value;"Wall"==e?v="black":"Door"==e?v="yellow":"Opening"==e?v="meganta":"Window"==e&&(v="cyan"),Ce()})()});let Ie=document.querySelector(".modalHelp-bg");document.getElementById("help").addEventListener("click",function(){Ie.classList.add("bgHelp-active"),Se.innerHTML=""}),document.getElementById("save-help-setup").addEventListener("click",function(){Ie.classList.remove("bgHelp-active")});let Be=document.querySelector(".modalCaution-bg");document.getElementById("caution").addEventListener("click",function(){Be.classList.add("bgCaution-active")}),document.getElementById("cautionCancel").addEventListener("click",function(){Be.classList.remove("bgCaution-active")});let qe=document.querySelector(".modalAbout-bg");document.getElementById("about").addEventListener("click",function(){qe.classList.add("bgAbout-active"),Se.innerHTML=""}),document.getElementById("save-About-setup").addEventListener("click",function(){qe.classList.remove("bgAbout-active")});let De=document.querySelector(".modalAutomate-bg");document.getElementById("automate").addEventListener("click",function(){De.classList.add("bgAutomate-active"),Se.innerHTML=""}),document.getElementById("automateCancel").addEventListener("click",function(){De.classList.remove("bgAutomate-active")}),document.getElementById("automation").addEventListener("click",function(){if(j.length>0){if(!0){let e=[];for(let t=0;t<L.length;t++){let n,l,i;for(let e=0;e<j.length;e++){let o=j[e].replace(/ /g,"");Y[t]==o&&(n=O[e],l=N[e],i=z[e],samecheck=!0)}let c={x:L[t].getX(),y:L[t].getY(),c:Y[t],g:o,s:x,sp:n,st:i,a:l};e.push(c)}let t=JSON.stringify(e),n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=new Date,t=String(e.getDate()).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();e=l+"/"+t+"/"+i;let o=n.response,c=document.createElement("a");c.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(o)),c.setAttribute("download",e+".dxf"),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)}},n.open("POST","/automate",!0),n.setRequestHeader("Content-type","application/json"),n.send(t)}}else alert("Kindly first confirm the spaces type and name to continue. To do this kindly click on Annotate/Confirm Space type and names.");De.classList.remove("bgAutomate-active")}),document.getElementById("shuffle").addEventListener("click",function(){$.classList.add("bgShuffle-active"),Se.innerHTML=""}),document.getElementById("shuffleCancel").addEventListener("click",function(){$.classList.remove("bgShuffle-active")}),document.getElementById("shuffler").addEventListener("click",function(){let e=c,t=a,n=0,l=0,r=c,s=a,g=0,d=0,h=!0;if(L.length>500?(h=!1,alert("Used cells should be less than 500 to activate shuffle command.")):0==Z.length?(h=!1,alert("Please draw the site/plot boundry.")):L.length<=500&&(h=!0),h&&L.length>0){let h=[];e=c,t=a,n=0,l=0;for(let i=0;i<L.length;i++){let o=new Vector(L[i].getX(),L[i].getY());o.getX()>n&&(n=o.getX()),o.getY()>l&&(l=o.getY()),o.getX()<e&&(e=o.getX()),o.getY()<t&&(t=o.getY())}for(let e=0;e<Z.length;e++){let t=new Vector(Z[e].v1.getX(),Z[e].v1.getY());t.getX()>g&&(g=t.getX()),t.getY()>d&&(d=t.getY()),t.getX()<r&&(r=t.getX()),t.getY()<s&&(s=t.getY())}F.splice(0,F.length),R.splice(0,R.length);for(let e=0;e<Y.length;e++)0==F.includes(Y[e])&&F.push(Y[e]);for(let e=0;e<F.length;e++){let t=ie(Y,F[e]);1==t?(t=Math.floor(24*Math.random())+12)%2==0?R.push(t):R.push(t+1):R.push(t)}for(i=0;i<F.length;i++){let c={c:F[i],n:R[i],g:o,minX:e,minY:t,maxX:n,maxY:l,minSiteX:r,minSiteY:s,maxSiteX:g,maxSiteY:d};h.push(c)}let u=JSON.stringify(h),m=new XMLHttpRequest;m.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(m.response);L.length;L.splice(0,L.length),Y.splice(0,Y.length);for(let t=0;t<e.length;t++){let n=new Vector(e[t].x,e[t].y),l=e[t].c;if(pe(n,L)){let e=fe(n,L);L.splice(e,1),Y.splice(e,1)}L.push(n),Y.push(l)}}},m.open("POST","/shuffle",!0),m.setRequestHeader("Content-type","application/json"),m.send(u)}$.classList.remove("bgShuffle-active")});let Pe=()=>{l.clearRect(0,0,c,a),_();for(let e=0;e<L.length;e++){new he(L[e],Y[e]).draw()}if(1==S||1==V){for(let e=0;e<Q.length;e++){new he(Q[e],"darkgreen").draw()}me()}if((()=>{for(let e=0;e<B.length;e++)if(q[e]){let t=new de(B[e],q[e]);t.changeCol(D[e]),t.changeWidth(P[e]),t.draw()}})(),(()=>{for(let e=0;e<Z.length;e++)Z[e].setDashPattern(100,50),Z[e].changeWidth(2),Z[e].changeCol("red"),Z[e].draw()})(),H&&(l.font="12px Arial",l.fillStyle="black",l.fillText("Welcome to Grids-AI:",10,a/2-40),l.fillText("1. Adjust grid/cell size from Project Setup menu (First button from Right)",10,a/2-20),l.fillText("2. Create a Site/Plot boundry (First button from Left) to get started.",10,a/2),l.fillText("3. Start creating a Space (Second button from Left).",10,a/2+20),l.fillText("4. This software is operational only from workstations/laptops/desktops.",10,a/2+40),l.fillText("2021 Copyrights @ Quantum Pixel Intelligence. All Rights Reserved.",10,a/2+60)),1==C&&0==M&&0==S&&0==V?(me(),l.font="12px Arial",l.fillStyle="black",l.fillText((u*Math.sqrt(x)).toFixed(2)+" x "+(m*Math.sqrt(x)).toFixed(2)+" m",w.getX()+20,w.getY()+20),l.fillText(Math.ceil(u*Math.sqrt(x)*3.28).toFixed(2)+" x "+Math.ceil(m*Math.sqrt(x)*3.28).toFixed(2)+" ft",w.getX()+20,w.getY()+40)):1==C&&1==M&&0==S&&0==V&&((()=>{for(let e=0;e<I.length;e++)I[e].setDashPattern(3,0,3),I[e].changeWidth(3),I[e].changeCol(v),I[e].draw()})(),l.font="12px Arial",l.fillStyle="black",l.fillText((p*Math.sqrt(x)).toFixed(2)+" m",w.getX()+20,w.getY()+20),l.fillText(Math.ceil(p*Math.sqrt(x)*3.28).toFixed(1)+" ft",w.getX()+20,w.getY()+40)),l.font="12px Arial",l.fillStyle="black",j.length>0){l.fillText("--- Area Statement ---",5,140);for(let e=0;e<j.length;e++){let t=new Vector(10,155+18*e),n=new ge(t,7);n.changeCol(j[e]),n.draw(),l.font="12px Arial",l.fillStyle="black",l.fillText("=> "+O[e]+" ("+N[e]+") - "+z[e],20,160+18*e)}}Ve&&((()=>{let e=n.toDataURL("static/Img/download/image.png");var t=document.createElement("a");t.download="my-image.png",t.href=e,t.click()})(),Ve=!1);let e=document.querySelector("#target").value,t=(Y.length*x).toFixed(2),i=c*(t/e),o=new Vector(5,5),r=new Vector(c,5),s=new de(o,r);s.changeWidth(20),s.changeCol("silver"),s.draw();let g=new Vector(7.5,7.5),d=new Vector(7.5+i,7.5),h=new de(g,d);h.changeWidth(10),h.changeCol(currentCol),h.draw(),l.fillText("Target = "+e+" SQM - "+(10.763*e).toFixed(0)+" SqFt",5,35),l.fillText("Consumed = "+t+" SQM - "+(10.763*t).toFixed(0)+" SqFt",5,55),l.fillText("Grid = "+Math.sqrt(x).toFixed(2)+" x "+Math.sqrt(x).toFixed(2)+" M",5,75),l.fillText("Grid = "+(3.2808*Math.sqrt(x)).toFixed(2)+" x "+(3.28*Math.sqrt(x)).toFixed(2)+" ft",5,95),l.fillText("Used Cells = "+L.length,5,115),requestAnimationFrame(Pe)};Pe()};